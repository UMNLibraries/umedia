require 'test_helper'

module Umedia
  class CollectionSampleItemsTest < ActiveSupport::TestCase
    it 'retrieves a set of sample items and a total primary page count for a collection' do
      response = {
        'response' => {
          'docs' => ['123'],
          'numFound' => 1
        }
      }
      solr = Minitest::Mock.new
      solr.expect :get, response, ["select", {:params=>{:rows=>3, :fl=>"*", :sort=>"featured_collection_order ASC", :q=>"set_spec:foobarbaz123 && document_type:item"}}]
      search = CollectionSampleItems.new(set_spec: "foobarbaz123", solr: solr)
      search.iiifables.first.doc_hash.must_equal "123"
      solr.verify
    end

    it 'retrieves sample items' do
      sample = CollectionSampleItems.new(set_spec: "p16022coll99")
      sample.iiifables.map {|item| item.doc_hash }.must_equal [{"id"=>"p16022coll99:49", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll99/id/49", "set_spec"=>"p16022coll99", "collection_name"=>"GLBT Pride Poster Collection", "collection_name_s"=>"GLBT Pride Poster Collection", "collection_description"=>"GLBT pride posters from across the state of Minnesota, circa 1974 through 2006.", "title"=>"Deja's Love Boat", "title_s"=>"Deja's Love Boat", "title_t"=>"Deja's Love Boat", "title_sort"=>"dejasloveboat", "description"=>"GLBT Pride Pageant and Boat Cruise", "types"=>["Still Image"], "format"=>["Posters | http://vocab.getty.edu/aat/300027221"], "format_name"=>["Posters"], "language"=>["English"], "city"=>["St. Paul"], "state"=>["Minnesota"], "country"=>["United States"], "continent"=>["North America"], "geonames"=>["http://sws.geonames.org/5045473/"], "parent_collection"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019); http://purl.umn.edu/40681", "parent_collection_name"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019)", "contributing_organization"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name_s"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contact_information"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies. 111 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/tretter", "local_identifier"=>["rar03066"], "dls_identifier"=>["rar03066"], "persistent_url"=>"http://purl.umn.edu/135070", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"image", "viewer_type"=>"image", "attachment"=>"41.jp2", "document_type"=>"item", "featured_collection_order"=>999, "_version_"=>1624654640541859840}, {"id"=>"p16022coll99:50", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll99/id/50", "set_spec"=>"p16022coll99", "collection_name"=>"GLBT Pride Poster Collection", "collection_name_s"=>"GLBT Pride Poster Collection", "collection_description"=>"GLBT pride posters from across the state of Minnesota, circa 1974 through 2006.", "title"=>"Twin Cities Pride, 30 years proud", "title_s"=>"Twin Cities Pride, 30 years proud", "title_t"=>"Twin Cities Pride, 30 years proud", "title_sort"=>"twincitiesprideyearsproud", "date_created"=>["2002"], "date_created_ss"=>["2002"], "date_created_sort"=>"2002", "contributor"=>["Paul Nixdorf Photography (Photographer)"], "contributor_ss"=>["Paul Nixdorf Photography (Photographer)"], "types"=>["Still Image"], "format"=>["Posters | http://vocab.getty.edu/aat/300027221"], "format_name"=>["Posters"], "language"=>["English"], "city"=>["Minneapolis"], "state"=>["Minnesota"], "country"=>["United States"], "continent"=>["North America"], "geonames"=>["http://sws.geonames.org/5037657/"], "parent_collection"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019); http://purl.umn.edu/40681", "parent_collection_name"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019)", "contributing_organization"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name_s"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contact_information"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies. 111 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/tretter", "local_identifier"=>["rar03065"], "dls_identifier"=>["rar03065"], "persistent_url"=>"http://purl.umn.edu/135068", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"image", "viewer_type"=>"image", "attachment"=>"42.jp2", "document_type"=>"item", "featured_collection_order"=>999, "_version_"=>1624654640542908416}, {"id"=>"p16022coll99:51", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll99/id/51", "set_spec"=>"p16022coll99", "collection_name"=>"GLBT Pride Poster Collection", "collection_name_s"=>"GLBT Pride Poster Collection", "collection_description"=>"GLBT pride posters from across the state of Minnesota, circa 1974 through 2006.", "title"=>"Minnesota Gay Pride '74", "title_s"=>"Minnesota Gay Pride '74", "title_t"=>"Minnesota Gay Pride '74", "title_sort"=>"minnesotagaypride", "date_created"=>["1974"], "date_created_ss"=>["1974"], "date_created_sort"=>"1974", "types"=>["Still Image"], "format"=>["Posters | http://vocab.getty.edu/aat/300027221"], "format_name"=>["Posters"], "language"=>["English"], "city"=>["Minneapolis"], "state"=>["Minnesota"], "country"=>["United States"], "continent"=>["North America"], "geonames"=>["http://sws.geonames.org/5037657/"], "parent_collection"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019); http://purl.umn.edu/40681", "parent_collection_name"=>"Twin Cities (TC) Pride Records, 1973-2014 (Tretter 019)", "contributing_organization"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contributing_organization_name_s"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.", "contact_information"=>"University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies. 111 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/tretter", "local_identifier"=>["rar03064"], "dls_identifier"=>["rar03064"], "persistent_url"=>"http://purl.umn.edu/135061", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"image", "viewer_type"=>"image", "attachment"=>"43.jp2", "document_type"=>"item", "featured_collection_order"=>999, "_version_"=>1624654640542908417}]
      sample.contributing_organization_name.must_equal 'University of Minnesota Libraries, Jean-Nickolaus Tretter Collection in Gay, Lesbian, Bisexual and Transgender Studies.'
    end
  end
end
