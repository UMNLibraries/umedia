require 'test_helper'

module Umedia
  class CollectionSampleItemsTest < ActiveSupport::TestCase
    it 'retrieves a set of sample items and a total primary page count for a collection' do
      response = {
        'response' => {
          'docs' => ['123'],
          'numFound' => 1
        }
      }
      solr = Minitest::Mock.new
      solr.expect :get, response, ["select", {:params=>{:rows=>3, :fl=>"*", :q=>"set_spec:foobarbaz123 && document_type:item"}}]
      search = CollectionSampleItems.new(set_spec: "foobarbaz123", solr: solr)
      search.iiifables.first.doc_hash.must_equal "123"
      solr.verify
    end

    it 'retrieves sample items' do
      sample = CollectionSampleItems.new(set_spec: "p16022coll128")
      sample.iiifables.map {|item| item.doc_hash }.must_equal [{"id"=>"p16022coll128:0", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll128/id/0", "set_spec"=>"p16022coll128", "collection_name"=>"Forecast Public Art Collection", "collection_name_s"=>"Forecast Public Art Collection", "collection_description"=>"This archival collection contains the records from Forecast Public Art, a St. Paul-based nonprofit arts organization dedicated to the study of and support for public art.", "title"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "title_s"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "title_t"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "title_alternative"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "title_alternative_s"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "title_alternative_t"=>"University of Minnesota Grant Program. Monica Sheets, audio file. (Box 9, Folder 33)", "date_created"=>["2005"], "date_created_ss"=>["2005"], "date_created_sort"=>"2005", "types"=>["Sound"], "format"=>["Interviews | http://vocab.getty.edu/aat/300026392"], "format_name"=>["Interviews "], "dimensions"=>"0:09:54", "subject"=>["Public Art."], "subject_ss"=>["Public Art."], "language"=>["English"], "country"=>["United States"], "continent"=>["North America"], "parent_collection"=>"Forecast Public Art Collection (N252)", "parent_collection_name"=>"Forecast Public Art Collection (N252)", "contributing_organization"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contributing_organization_name"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contact_information"=>"University of Minnesota Libraries, Northwest Architectural Archives. 213 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/naa", "local_identifier"=>["forecast-archives-box09-fdr33"], "dls_identifier"=>["forecast-archives-box09-fdr33"], "persistent_url"=>"http://purl.umn.edu/135383", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "kaltura_audio"=>"1_uof19xyb", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"kaltura_audio", "viewer_type"=>"kaltura_audio", "attachment"=>"19.url", "document_type"=>"item", "featured_collection_order"=>3, "_version_"=>1622946949323816960}, {"id"=>"p16022coll128:1", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll128/id/1", "set_spec"=>"p16022coll128", "collection_name"=>"Forecast Public Art Collection", "collection_name_s"=>"Forecast Public Art Collection", "collection_description"=>"This archival collection contains the records from Forecast Public Art, a St. Paul-based nonprofit arts organization dedicated to the study of and support for public art.", "title"=>"Newfound Street Sound Installation", "title_s"=>"Newfound Street Sound Installation", "title_t"=>"Newfound Street Sound Installation", "title_alternative"=>"Newfound Street Sound Installation", "title_alternative_s"=>"Newfound Street Sound Installation", "title_alternative_t"=>"Newfound Street Sound Installation", "creator"=>["Becker, Jack"], "creator_ss"=>["Becker, Jack"], "creator_sort"=>"Becker, Jack", "types"=>["Moving Image"], "format"=>["Short subjects | http://vocab.getty.edu/aat/300263846"], "format_name"=>["Short subjects "], "dimensions"=>"0:02:34", "subject"=>["Jack Becker"], "subject_ss"=>["Jack Becker"], "language"=>["English"], "city"=>["Minneapolis"], "state"=>["Minnesota"], "country"=>["United States"], "continent"=>["North America"], "parent_collection"=>"Forecast Public Art Collection (N252)", "parent_collection_name"=>"Forecast Public Art Collection (N252)", "contributing_organization"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contributing_organization_name"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contact_information"=>"University of Minnesota Libraries, Northwest Architectural Archives. 213 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/naa", "local_identifier"=>["naa-forecast-av10"], "dls_identifier"=>["mss02314"], "persistent_url"=>"http://purl.umn.edu/138864", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "kaltura_video"=>"1_xpsb5weu", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"kaltura_video", "viewer_type"=>"kaltura_video", "attachment"=>"17.url", "document_type"=>"item", "featured_collection_order"=>3, "_version_"=>1622946949324865536}, {"id"=>"p16022coll128:2", "object"=>"https://cdm16022.contentdm.oclc.org/utils/getthumbnail/collection/p16022coll128/id/2", "set_spec"=>"p16022coll128", "collection_name"=>"Forecast Public Art Collection", "collection_name_s"=>"Forecast Public Art Collection", "collection_description"=>"This archival collection contains the records from Forecast Public Art, a St. Paul-based nonprofit arts organization dedicated to the study of and support for public art.", "title"=>"Americans for the Arts Award: Jack Becker", "title_s"=>"Americans for the Arts Award: Jack Becker", "title_t"=>"Americans for the Arts Award: Jack Becker", "title_alternative"=>"Americans for the Arts Award: Jack Becker", "title_alternative_s"=>"Americans for the Arts Award: Jack Becker", "title_alternative_t"=>"Americans for the Arts Award: Jack Becker", "description"=>"Public Art Network Award", "creator"=>["Hanson, Steve"], "creator_ss"=>["Hanson, Steve"], "creator_sort"=>"Hanson, Steve", "notes"=>"Section Titles:; Jack's acceptance talk/slide show; Transplant narrative; Slideshow from Jack's party at the Minnesota Center for Photography; Acknowledgements; Jack was newly recovering from his heart transplant - one of his first appearances since the surgery.; See other print materials about Fore-Site for details.", "types"=>["Moving Image"], "format"=>["Short subjects | http://vocab.getty.edu/aat/300263846"], "format_name"=>["Short subjects "], "dimensions"=>"0:15:08", "subject"=>["Forecast People and Places"], "subject_ss"=>["Forecast People and Places"], "language"=>["English"], "city"=>["St. Paul"], "state"=>["Minnesota"], "country"=>["United States"], "continent"=>["North America"], "parent_collection"=>"Forecast Public Art Collection (N252)", "parent_collection_name"=>"Forecast Public Art Collection (N252)", "contributing_organization"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contributing_organization_name"=>"University of Minnesota Libraries, Northwest Architectural Archives.", "contact_information"=>"University of Minnesota Libraries, Northwest Architectural Archives. 213 Elmer L. Andersen Library, 222 - 21st Avenue South, Minneapolis, MN 55455; https://www.lib.umn.edu/naa", "local_identifier"=>["naa-forecast-av24"], "dls_identifier"=>["mss07417"], "persistent_url"=>"http://purl.umn.edu/138551", "local_rights"=>"Use of this item may be governed by US and international copyright laws. You may be able to use this item, but copyright and other considerations may apply. For possible additional information or guidance on your use, please contact the contributing organization.", "kaltura_video"=>"1_fhp8ry5p", "page_count"=>0, "record_type"=>"primary", "first_viewer_type"=>"kaltura_video", "viewer_type"=>"kaltura_video", "attachment"=>"25.url", "document_type"=>"item", "featured_collection_order"=>3, "_version_"=>1622946949325914112}]
      sample.contributing_organization_name.must_equal 'University of Minnesota Libraries, Northwest Architectural Archives.'
    end
  end
end
